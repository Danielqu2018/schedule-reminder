# 团队项目管理系统 - 功能需求分析

## 需求总结

将现有的个人日程管理系统升级为支持团队协作的完整项目管理系统。

---

## 功能需求详解

### 1. 团队和工作组管理

#### 1.1 团队（Team）功能

**功能点：**
- 创建团队
- 管理团队成员
- 设置团队角色（Owner/Admin/Member）
- 团队成员邀请和审批

**用户故事：**
```
作为团队Owner，我希望能够：
- 创建一个团队
- 邀请成员加入团队
- 设置成员的不同权限
- 管理团队的资源和任务
```

**角色定义：**
- **Owner（所有者）**：完全控制权，可以删除团队
- **Admin（管理员）**：管理工作组和任务，但不能删除团队
- **Member（成员）**：只能查看和更新分配给自己的任务

#### 1.2 工作组（Work Group）功能

**功能点：**
- 创建工作组
- 分配团队成员到工作组
- 设置工作组组长
- 工作组专注于特定类型任务

**用户故事：**
```
作为团队管理员，我希望能够：
- 根据任务类型创建不同的工作组
- 将合适的成员分配到工作组
- 指定工作组组长负责协调
```

**工作组分类示例：**
- 开发组
- 设计组
- 测试组
- 市场组
- 运营组

---

### 2. 任务和工作子项管理

#### 2.1 任务（Task）功能

**功能点：**
- 创建任务
- 分配任务到工作组
- 设置任务优先级（低/中/高）
- 设置任务时间范围（开始/结束日期）
- 任务状态管理

**任务属性：**
- 标题
- 描述
- 开始日期
- 结束日期
- 优先级
- 状态
- 负责工作组

#### 2.2 工作子项（Work Item）功能

**核心功能：**
1. **执行顺序管理**
   - 并行执行（Parallel）
   - 顺序执行（Sequential）
   - 自动排序和依赖管理

2. **时间管理**
   - 计划开始时间
   - 需要时长（Duration Hours）
   - 计划完成时间（与时长二选一）
   - 自动计算

3. **人员分配**
   - 负责人（Assignee）：主要执行者
   - 配合人（Collaborators）：需要配合的人员列表

4. **工作目标**
   - 录入工作目标要求
   - 明确验收标准
   - 关联文档或资源

**用户故事：**
```
作为项目经理，我希望能够：
- 将一个大任务拆分成多个工作子项
- 指定哪些子项可以并行，哪些必须顺序执行
- 为每个子项分配负责人和配合人员
- 设定每个子项的时间要求和目标
- 自动生成清晰的执行清单
```

---

### 3. 工作子项录入规范

#### 3.1 基本信息

**必填字段：**
- 标题
- 执行顺序（并行/顺序）
- 计划开始时间
- 负责人
- 工作目标

**可选字段：**
- 描述
- 配合人员
- 进度（0-100%）

#### 3.2 时间管理（二选一）

**选项A：使用时长**
```
计划开始时间：2025-01-25 09:00
需要时长：8 小时
→ 自动计算：计划完成时间 = 2025-01-25 17:00
```

**选项B：使用计划完成时间**
```
计划开始时间：2025-01-25 09:00
计划完成时间：2025-01-25 18:00
→ 自动计算：需要时长 = 9 小时
```

**输入验证：**
- 如果填写时长，不显示或禁用计划完成时间输入
- 如果填写计划完成时间，不显示或禁用时长输入
- 确保完成时间晚于开始时间

#### 3.3 执行顺序

**并行执行（Parallel）：**
```
子项1: 需求调研
子项2: 技术方案
子项3: 界面设计
→ 这三个子项可以同时进行
```

**顺序执行（Sequential）：**
```
子项1: 需求调研 (顺序号: 1)
子项2: 技术方案 (顺序号: 2)
子项3: 详细设计 (顺序号: 3)
→ 必须按顺序依次完成
```

**混合模式：**
```
阶段1（并行）：
  - 子项1: 后端调研
  - 子项2: 前端调研

阶段2（顺序，依赖于阶段1）：
  - 子项3: 技术方案设计
  - 子项4: 接口定义
  - 子项5: 数据库设计

阶段3（并行，依赖于阶段2）：
  - 子项6: 后端开发
  - 子项7: 前端开发
  - 子项8: UI开发
```

#### 3.4 人员管理

**负责人（Assignee）：**
- 工作子项的主要责任人
- 需要更新子项进度
- 负责子项的最终完成

**配合人（Collaborators）：**
- 需要配合完成的人员
- 可能涉及多个人员
- 支持多选（Checkbox选择器）
- 可以查看但不能编辑

**配合场景示例：**
```
子项：后端API开发
负责人：后端工程师A
配合人：
  ☑ 数据库工程师B（需要提供数据支持）
  ☑ 测试工程师C（需要配合测试）
  ☑ 前端工程师D（需要对接接口）
```

#### 3.5 工作目标要求

**目标内容：**
- 明确的工作目标
- 验收标准
- 技术要求
- 质量标准
- 交付物要求

**示例：**
```
工作目标：
1. 完成用户登录API开发
2. 支持邮箱密码和OAuth登录
3. 登录接口响应时间<200ms
4. 单元测试覆盖率>90%
5. 提供完整的API文档
```

---

### 4. 工作子项清单自动生成

#### 4.1 生成逻辑

**基于执行顺序：**
```
1. 先按task_id分组所有子项
2. 同一任务内：
   - 先按execution_order分组（parallel > sequential）
   - 并行子项组按planned_start_time排序
   - 顺序子项组按sequence_number排序
3. 跨任务：
   - 按任务的start_date排序
```

**清单结构：**
```
任务A: 用户管理系统
  工作组: 开发组
  
  【并行阶段1】可同时开始
    ✓ 子项1: 需求调研（计划：09:00-12:00）
    ✓ 子项2: 技术调研（计划：09:00-13:00）
  
  【顺序阶段2】需等待阶段1完成
    → 子项3: 技术方案设计（计划：13:00-15:00，依赖子项1、2）
    → 子项4: 数据库设计（计划：15:00-17:00，依赖子项3）
  
  【并行阶段3】需等待阶段2完成
    ✓ 子项5: 后端开发（计划：09:00-17:00，依赖子项4）
    ✓ 子项6: 前端开发（计划：09:00-17:00，依赖子项4）
```

#### 4.2 清单视图

**列表视图：**
- 显示完整的工作子项清单
- 区分并行和顺序阶段
- 显示依赖关系
- 标注负责人和配合人
- 显示当前进度

**甘特图视图（可选）：**
- 时间轴显示
- 并行子项在同一行
- 顺序子项显示依赖箭头

---

### 5. 统计功能

#### 5.1 任务统计

**统计维度：**
- 按时间段统计（保持现有功能）
- 按状态统计
- 按优先级统计
- 按工作组统计

**统计指标：**
- 总任务数
- 各状态任务数
- 任务完成率
- 任务分布图
- 趋势分析

#### 5.2 人员工作完成情况统计

**统计对象：**
- 只统计负责人（assignee）
- 不统计配合人

**统计维度：**
- 按人员统计
- 按时间段统计
- 按工作组统计
- 按任务类型统计

**统计指标：**
```javascript
{
  "userId": "xxx",
  "userName": "张三",
  "totalAssigned": 20,        // 总分配数
  "completed": 15,            // 已完成
  "inProgress": 3,           // 进行中
  "pending": 2,              // 待办
  "completionRate": 75,       // 完成率%
  "averageDuration": 8.5,     // 平均时长（小时）
  "onTimeRate": 80,          // 按时完成率%
  "qualityScore": 4.5,        // 质量评分
  "tasksByStatus": {          // 按状态分组
    "completed": 15,
    "inProgress": 3,
    "pending": 2
  },
  "tasksByPriority": {        // 按优先级分组
    "high": 5,
    "medium": 10,
    "low": 5
  }
}
```

**统计展示：**
1. **人员排名表格**
   - 姓名
   - 完成率排名
   - 任务数量
   - 时长统计

2. **人员统计卡片**
   - 头像/姓名
   - 完成率（大字号）
   - 负责任务数
   - 本周/本月表现

3. **团队效率分析**
   - 整体完成率
   - 按时完成率
   - 平均完成时长
   - 工作组对比

4. **个人工作负载**
   - 当前进行中任务数
   - 计划中任务数
   - 工作饱和度
   - 建议调整

---

## 用户界面设计

### 主导航结构

```
┌─────────────────────────────────────────┐
│  团队项目管理系统           [切换团队]│
├─────────────────────────────────────────┤
│  概览  │  任务  │  工作子项  │  统计  │
└─────────────────────────────────────────┘
```

### 1. 概览页面

**内容：**
- 团队信息卡片
- 我的工作组
- 我的任务概览
- 团队动态

### 2. 任务管理页面

**内容：**
- 任务列表
- 筛选和排序
- 创建任务按钮
- 任务详情视图

### 3. 工作子项页面

**内容：**
- 工作子项清单
- 执行顺序可视化
- 子项详情和编辑
- 进度更新

### 4. 统计分析页面

**内容：**
- 任务统计
- 人员绩效统计
- 团队效率分析
- 图表展示

---

## 权限矩阵

| 功能 | Owner | Admin | Member | 负责人 | 配合人 |
|------|--------|-------|--------|----------|----------|
| 创建团队 | ✓ | ✗ | ✗ | ✗ | ✗ |
| 删除团队 | ✓ | ✗ | ✗ | ✗ | ✗ |
| 添加成员 | ✓ | ✓ | ✗ | ✗ | ✗ |
| 移除成员 | ✓ | ✗ | ✗ | ✗ | ✗ |
| 创建工作组 | ✓ | ✓ | ✗ | ✗ | ✗ |
| 删除工作组 | ✓ | ✗ | ✗ | ✗ | ✗ |
| 创建任务 | ✓ | ✓ | ✗ | ✗ | ✗ |
| 删除任务 | ✓ | ✓ | ✗ | ✗ | ✗ |
| 分配任务 | ✓ | ✓ | ✗ | ✗ | ✗ |
| 创建工作子项 | ✓ | ✓ | ✗ | ✓ | ✗ |
| 编辑工作子项 | ✓ | ✓ | ✗ | ✓ | ✗ |
| 更新子项进度 | ✓ | ✓ | ✓ | ✓ | ✓ |
| 查看工作子项 | ✓ | ✓ | ✓ | ✓ | ✓ |
| 查看统计 | ✓ | ✓ | ✓ | 只看自己 | 只看自己 |

---

## 技术架构建议

### 前端架构

**推荐使用框架：**
- React + TypeScript
- Vue 3 + TypeScript
- Angular + TypeScript

**状态管理：**
- Redux Toolkit / Zustand（React）
- Pinia（Vue）
- NgRx（Angular）

**UI组件库：**
- Material-UI
- Ant Design
- Chakra UI
- Radix UI

**可视化库：**
- Recharts / Chart.js
- Apache ECharts
- D3.js

### 后端架构

**建议保持：**
- 继续使用Supabase
- 利用Supabase RLS
- 使用Supabase Realtime

**新增服务：**
- Supabase Edge Functions（复杂业务逻辑）
- Supabase Database Functions（数据分析）

---

## 实施路线图

### 阶段一：基础设施（2-3天）
1. 数据库表设计和创建
2. RLS策略实施
3. 迁移现有数据
4. API接口设计

### 阶段二：团队管理（3-4天）
1. 团队创建和管理UI
2. 成员邀请和权限管理
3. 工作组管理
4. 团队导航和切换

### 阶段三：任务管理（4-5天）
1. 任务CRUD功能
2. 任务列表和筛选
3. 任务详情和编辑
4. 工作组关联

### 阶段四：工作子项管理（5-6天）
1. 工作子项CRUD
2. 执行顺序配置
3. 时间管理（时长/完成时间二选一）
4. 人员分配（负责人/配合人）
5. 目标录入

### 阶段五：清单生成（2-3天）
1. 自动排序逻辑
2. 清单视图展示
3. 依赖关系可视化
4. 进度跟踪

### 阶段六：统计分析（3-4天）
1. 任务统计扩展
2. 人员绩效统计
3. 可视化图表
4. 导出功能

### 阶段七：优化和测试（2-3天）
1. 性能优化
2. 测试（单元/集成/E2E）
3. 用户体验优化
4. 文档完善

**总计：约 21-28 天**

---

## 风险和挑战

### 1. 数据迁移风险
- 现有数据结构简单，新结构复杂
- 需要处理数据一致性
- 建议创建完整的数据迁移计划

### 2. 权限管理复杂性
- RLS策略需要仔细设计
- 角色管理需要灵活且安全
- 需要充分的权限测试

### 3. 性能挑战
- 大量工作子项可能影响查询性能
- 统计计算可能较慢
- 需要索引优化和缓存策略

### 4. 用户体验
- 功能复杂度增加
- 需要良好的引导和文档
- 建议分阶段发布

---

## 成功指标

### 功能指标
- 团队管理功能正常运行
- 工作子项自动排序准确
- 统计数据准确无误
- 权限控制有效

### 性能指标
- 页面加载时间 < 2秒
- 工作子项查询 < 500ms
- 统计计算 < 1秒
- 支持并发用户数 > 50

### 用户满意度
- 任务完成率提升 > 20%
- 团队协作效率提升
- 用户满意度评分 > 4/5

---

## 下一步行动

1. **评审数据库设计** - 与团队确认表结构
2. **选择技术栈** - 确定是否升级到框架
3. **创建原型** - 快速验证关键交互
4. **制定详细计划** - 细化每个阶段的任务
5. **开始实施** - 按照路线图逐步推进